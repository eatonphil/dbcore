project: todo

database:
  dialect: sqlite
  database: todo.db

api:
  routerPrefix: v1/
  auth:
    enabled: true
    filter:
      notes:
        # Must be public or tied to the current user's organization.
        get: (notes [is_public] + notes [organization = (users [id = $user_id] {id})]) [id = $object_id]
        # Must be created by the user or tied to the current user's organization and an admin.
        put: &ownedOrOrgAdmin (notes [created_by = $user_id] + notes [organization = (users [id = $user_id & is_admin] {id})]) [id = $object_id]
        # Same as edit (put)
        delete: *ownedOrOrgAdmin
        # Must be in the same org
        post: notes [organization = (users [id = $user_id] {id})]
      users:
        # Must be in the same org
        get: users [organization = (users [id = $user_id] {id})]
        put: users [organization = (users [id = $user_id] {id})]
        delete: &inOrgandIsadmin users [organization = (users [id = $user_id] {id}) & is_admin]
        post: *inOrgandIsadmin
      organizations:
        get: *inOrg
        put: *inOrgAndIsAdmin
        delete: *inOrgandIsadmin
  audit:
    enabled: true
    createdAt: created_at
    updatedAt: updated_at
    deletedAt: deleted_at
  extra:
    repo: github.com/eatonphil/dbcore-todo

browser: {}
